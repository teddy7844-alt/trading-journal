<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Trade Journal</title>
<link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600;700;800&family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #080a0f;
  --bg2: #0d1018;
  --bg3: #111520;
  --surface: #141820;
  --surface2: #1a1f2e;
  --border: #1e2435;
  --border2: #252d40;
  --text: #c8d0e8;
  --text2: #7a8299;
  --text3: #4a5268;

  --cyan: #00e5ff;
  --cyan-dim: rgba(0,229,255,0.08);
  --cyan-border: rgba(0,229,255,0.25);

  --purple: #b44fff;
  --purple-dim: rgba(180,79,255,0.08);
  --purple-border: rgba(180,79,255,0.25);

  --green: #00ff88;
  --green-dim: rgba(0,255,136,0.07);
  --green-border: rgba(0,255,136,0.2);

  --red: #ff3b5c;
  --red-dim: rgba(255,59,92,0.07);
  --red-border: rgba(255,59,92,0.2);

  --gold: #ffb700;
  --gold-dim: rgba(255,183,0,0.07);
  --gold-border: rgba(255,183,0,0.2);

  --orange: #ff6b00;
}

html { font-size: 15px; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Oxanium', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

/* ---- HEADER ---- */
.app-header {
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 56px;
  position: sticky;
  top: 0;
  z-index: 100;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-mark {
  width: 32px; height: 32px;
  background: linear-gradient(135deg, var(--cyan), var(--purple));
  border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem;
}

.logo-text {
  font-size: 1rem;
  font-weight: 800;
  letter-spacing: 3px;
  text-transform: uppercase;
  background: linear-gradient(90deg, var(--cyan), var(--purple));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.header-stats {
  display: flex;
  gap: 24px;
}

.hstat {
  text-align: right;
}

.hstat-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.6rem;
  color: var(--text3);
  letter-spacing: 2px;
  text-transform: uppercase;
}

.hstat-value {
  font-size: 0.9rem;
  font-weight: 700;
  font-family: 'DM Mono', monospace;
}

.hstat-value.positive { color: var(--green); }
.hstat-value.negative { color: var(--red); }
.hstat-value.neutral { color: var(--text); }

/* ---- TABS ---- */
.tab-bar {
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  display: flex;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.tab-bar::-webkit-scrollbar { display: none; }

.tab-btn {
  padding: 14px 20px;
  font-family: 'Oxanium', sans-serif;
  font-size: 0.78rem;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text3);
  border: none;
  background: transparent;
  cursor: pointer;
  white-space: nowrap;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
  position: relative;
}

.tab-btn:hover { color: var(--text2); }
.tab-btn.active-ib { color: var(--cyan); border-bottom-color: var(--cyan); }
.tab-btn.active-fib { color: var(--purple); border-bottom-color: var(--purple); }
.tab-btn.active-wib { color: #00ffcc; border-bottom-color: #00ffcc; }
.tab-btn.active-log { color: var(--gold); border-bottom-color: var(--gold); }
.tab-btn.active-stats { color: var(--green); border-bottom-color: var(--green); }

/* ---- MAIN CONTENT ---- */
.tab-content { display: none; padding: 20px; max-width: 900px; margin: 0 auto; }
.tab-content.active { display: block; }

/* ---- SECTION HEADER ---- */
.section-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
  padding-bottom: 14px;
  border-bottom: 1px solid var(--border);
}

.section-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.section-title {
  font-size: 1.1rem;
  font-weight: 800;
  letter-spacing: 3px;
  text-transform: uppercase;
}

.ib-accent { color: var(--cyan); background: var(--cyan); }
.fib-accent { color: var(--purple); background: var(--purple); }
.log-accent { color: var(--gold); background: var(--gold); }
.stats-accent { color: var(--green); background: var(--green); }

/* ---- CALCULATOR CARD ---- */
.calc-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 16px;
}

.calc-card-title {
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text3);
  margin-bottom: 16px;
  font-family: 'DM Mono', monospace;
}

.calc-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 12px;
  margin-bottom: 16px;
}

.calc-field {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.calc-label {
  font-size: 0.62rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: #c0c8de;
  font-family: 'DM Mono', monospace;
}

.calc-input {
  background: var(--bg3);
  border: 1px solid var(--border2);
  border-radius: 4px;
  padding: 10px 12px;
  color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 0.9rem;
  width: 100%;
  transition: border-color 0.2s;
  -webkit-appearance: none;
}

.calc-input:focus {
  outline: none;
  border-color: var(--cyan);
}

.calc-input.fib-focus:focus { border-color: var(--purple); }

.calc-result {
  background: var(--bg);
  border-radius: 8px;
  padding: 16px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 12px;
}

.result-item { text-align: center; }

.result-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text3);
  margin-bottom: 4px;
}

.result-value {
  font-size: 1.3rem;
  font-weight: 700;
  font-family: 'DM Mono', monospace;
}

.result-value.cyan { color: var(--cyan); }
.result-value.purple { color: var(--purple); }
.result-value.green { color: var(--green); }
.result-value.gold { color: var(--gold); }
.result-value.orange { color: var(--orange); }
.result-value.red { color: var(--red); }

/* ---- FORM ---- */
.form-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 16px;
}

.form-section-header {
  padding: 10px 16px;
  font-size: 0.65rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  font-family: 'DM Mono', monospace;
  font-weight: 500;
}

.form-section-header.ib { background: rgba(0,229,255,0.06); color: var(--cyan); border-bottom: 1px solid var(--cyan-border); }
.form-section-header.fib { background: rgba(180,79,255,0.06); color: var(--purple); border-bottom: 1px solid var(--purple-border); }
.form-section-header.green { background: var(--green-dim); color: var(--green); border-bottom: 1px solid var(--green-border); }
.form-section-header.red { background: var(--red-dim); color: var(--red); border-bottom: 1px solid var(--red-border); }
.form-section-header.gold { background: var(--gold-dim); color: var(--gold); border-bottom: 1px solid var(--gold-border); }
.form-section-header.grey { background: var(--surface2); color: var(--text2); border-bottom: 1px solid var(--border); }

.form-body {
  padding: 16px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 12px;
}

.form-body.full { grid-template-columns: 1fr; }
.form-body.two { grid-template-columns: 1fr 1fr; }
.form-body.three { grid-template-columns: 1fr 1fr 1fr; }

@media (max-width: 500px) {
  .form-body.three { grid-template-columns: 1fr 1fr; }
  .form-body.two { grid-template-columns: 1fr; }
}

.form-field {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.form-label {
  font-size: 0.62rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: #c0c8de;
  font-family: 'DM Mono', monospace;
}

.form-input, .form-select, .form-textarea {
  background: var(--bg3);
  border: 1px solid var(--border2);
  border-radius: 4px;
  padding: 10px 12px;
  color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 0.85rem;
  width: 100%;
  transition: border-color 0.2s;
  -webkit-appearance: none;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
  outline: none;
  border-color: var(--cyan);
}

.fib-form .form-input:focus,
.fib-form .form-select:focus,
.fib-form .form-textarea:focus { border-color: var(--purple); }

.form-textarea { resize: vertical; min-height: 72px; }

.form-select option { background: var(--bg3); }

/* radio group */
.radio-group {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.radio-option {
  flex: 1;
  min-width: 60px;
}

.radio-option input { display: none; }

.radio-option label {
  display: block;
  text-align: center;
  padding: 9px 8px;
  border: 1px solid var(--border2);
  border-radius: 4px;
  font-size: 0.78rem;
  font-weight: 600;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.15s;
  background: var(--bg3);
  color: var(--text2);
}

.radio-option input:checked + label {
  border-color: var(--cyan);
  background: var(--cyan-dim);
  color: var(--cyan);
}

.fib-form .radio-option input:checked + label {
  border-color: var(--purple);
  background: var(--purple-dim);
  color: var(--purple);
}

/* fib level display */
.fib-levels-display {
  background: var(--bg);
  border-radius: 6px;
  padding: 12px;
  margin: 0 16px 16px;
}

.fib-levels-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
}

@media (max-width: 500px) {
  .fib-levels-grid { grid-template-columns: repeat(2, 1fr); }
}

.fib-level-item {
  text-align: center;
  padding: 8px 6px;
  border-radius: 4px;
  border: 1px solid var(--border);
}

.fib-level-item.entry-zone {
  border-color: var(--green-border);
  background: var(--green-dim);
}

.fib-level-item.stop-zone {
  border-color: var(--red-border);
  background: var(--red-dim);
}

.fib-level-item.target-zone {
  border-color: var(--gold-border);
  background: var(--gold-dim);
}

.fib-level-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.58rem;
  color: var(--text3);
  letter-spacing: 1px;
  margin-bottom: 3px;
}

.fib-level-value {
  font-family: 'DM Mono', monospace;
  font-size: 0.9rem;
  font-weight: 500;
}

.fib-level-item.entry-zone .fib-level-value { color: var(--green); }
.fib-level-item.stop-zone .fib-level-value { color: var(--red); }
.fib-level-item.target-zone .fib-level-value { color: var(--gold); }

/* ---- SAVE BUTTON ---- */
.save-btn {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 6px;
  font-family: 'Oxanium', sans-serif;
  font-size: 0.85rem;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 8px;
}

.save-btn.ib {
  background: linear-gradient(135deg, #004455, #006677);
  color: var(--cyan);
  border: 1px solid var(--cyan-border);
}

.save-btn.ib:hover {
  background: linear-gradient(135deg, #005566, #007788);
  box-shadow: 0 0 20px rgba(0,229,255,0.15);
}

.save-btn.fib {
  background: linear-gradient(135deg, #2a0044, #3d0066);
  color: var(--purple);
  border: 1px solid var(--purple-border);
}

.save-btn.fib:hover {
  background: linear-gradient(135deg, #350055, #4a0077);
  box-shadow: 0 0 20px rgba(180,79,255,0.15);
}

/* ---- TRADE LOG ---- */
.trade-filters {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.filter-btn {
  padding: 7px 14px;
  border-radius: 20px;
  border: 1px solid var(--border2);
  background: var(--surface);
  color: var(--text2);
  font-family: 'Oxanium', sans-serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
}

.filter-btn:hover { border-color: var(--border2); color: var(--text); }
.filter-btn.active { background: var(--surface2); color: var(--text); border-color: var(--border2); }
.filter-btn.f-ib.active { border-color: var(--cyan); color: var(--cyan); background: var(--cyan-dim); }
.filter-btn.f-fib.active { border-color: var(--purple); color: var(--purple); background: var(--purple-dim); }

.trades-list { display: flex; flex-direction: column; gap: 10px; }

.trade-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  transition: border-color 0.2s;
}

.trade-card:hover { border-color: var(--border2); }
.trade-card.ib-card { border-left: 3px solid var(--cyan); }
.trade-card.fib-card { border-left: 3px solid var(--purple); }

.trade-card-header {
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}

.trade-card-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.trade-system-badge {
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 2px;
  padding: 3px 8px;
  border-radius: 3px;
  text-transform: uppercase;
  font-family: 'DM Mono', monospace;
}

.badge-ib { background: var(--cyan-dim); color: var(--cyan); border: 1px solid var(--cyan-border); }
.badge-fib { background: var(--purple-dim); color: var(--purple); border: 1px solid var(--purple-border); }
.badge-wib { background: rgba(0,255,204,0.1); color: #00ffcc; border: 1px solid rgba(0,255,204,0.3); }

.trade-ticker {
  font-size: 1.1rem;
  font-weight: 800;
  letter-spacing: 2px;
}

.trade-date {
  font-family: 'DM Mono', monospace;
  font-size: 0.72rem;
  color: var(--text3);
}

.trade-card-right {
  text-align: right;
}

.trade-pnl {
  font-family: 'DM Mono', monospace;
  font-size: 1rem;
  font-weight: 700;
}

.trade-pnl.win { color: var(--green); }
.trade-pnl.loss { color: var(--red); }
.trade-pnl.open { color: var(--gold); }

.trade-rr {
  font-family: 'DM Mono', monospace;
  font-size: 0.7rem;
  color: var(--text3);
}

.trade-card-detail {
  display: none;
  padding: 0 16px 14px;
  border-top: 1px solid var(--border);
  margin-top: 4px;
}

.trade-card-detail.open { display: block; }

.detail-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 10px;
  padding-top: 12px;
}

.detail-item {}
.detail-item-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.58rem;
  color: var(--text3);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 3px;
}
.detail-item-value {
  font-family: 'DM Mono', monospace;
  font-size: 0.85rem;
  color: var(--text);
}

.trade-notes-display {
  margin-top: 10px;
  padding: 10px;
  background: var(--bg);
  border-radius: 4px;
  font-size: 0.8rem;
  color: var(--text2);
  line-height: 1.5;
}

.delete-btn {
  margin-top: 10px;
  padding: 6px 14px;
  background: var(--red-dim);
  border: 1px solid var(--red-border);
  border-radius: 4px;
  color: var(--red);
  font-family: 'Oxanium', sans-serif;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text3);
}

.empty-state-icon { font-size: 2.5rem; margin-bottom: 12px; }
.empty-state-text { font-size: 0.85rem; letter-spacing: 2px; text-transform: uppercase; font-family: 'DM Mono', monospace; }

/* ---- STATS ---- */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 12px;
  margin-bottom: 20px;
}

.stat-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 16px;
  text-align: center;
}

.stat-card-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.6rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text3);
  margin-bottom: 8px;
}

.stat-card-value {
  font-family: 'DM Mono', monospace;
  font-size: 1.6rem;
  font-weight: 700;
}

.grade-breakdown {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 16px;
}

.grade-title {
  font-size: 0.65rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text3);
  font-family: 'DM Mono', monospace;
  margin-bottom: 14px;
}

.grade-bars { display: flex; flex-direction: column; gap: 8px; }

.grade-bar-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.grade-bar-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.8rem;
  font-weight: 700;
  width: 20px;
  text-align: center;
}

.grade-bar-track {
  flex: 1;
  height: 8px;
  background: var(--bg);
  border-radius: 4px;
  overflow: hidden;
}

.grade-bar-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.6s ease;
}

.grade-bar-count {
  font-family: 'DM Mono', monospace;
  font-size: 0.75rem;
  color: var(--text3);
  width: 20px;
  text-align: right;
}

/* toast */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 6px;
  padding: 12px 20px;
  font-size: 0.8rem;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  font-family: 'DM Mono', monospace;
  transition: transform 0.3s ease;
  z-index: 1000;
  white-space: nowrap;
}
.toast.show { transform: translateX(-50%) translateY(0); }
.toast.success { color: var(--green); border-color: var(--green-border); }
.toast.error { color: var(--red); border-color: var(--red-border); }

/* scrollbar */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
</style>
</head>
<body>

<div class="app-header">
  <div class="logo">
    <div class="logo-mark">üìà</div>
    <div class="logo-text">TradeLog</div>
  </div>
  <div class="header-stats">
    <div class="hstat">
      <div class="hstat-label">Total P&L</div>
      <div class="hstat-value neutral" id="header-pnl">$0.00</div>
    </div>
    <div class="hstat">
      <div class="hstat-label">Win Rate</div>
      <div class="hstat-value neutral" id="header-wr">‚Äî</div>
    </div>
  </div>
</div>

<div class="tab-bar">
  <button class="tab-btn active-ib" onclick="showTab('ib')">üìä Inside Bar ‚Äî BTC</button>
  <button class="tab-btn" onclick="showTab('fib')">üìê Fibonacci</button>
  <button class="tab-btn" onclick="showTab('wib')">üìà Weekly Stock IB</button>
  <button class="tab-btn" onclick="showTab('log')">üìã Trade Log</button>
  <button class="tab-btn" onclick="showTab('stats')">üìà Stats</button>
</div>

<!-- ==================== TAB: INSIDE BAR ==================== -->
<div class="tab-content active" id="tab-ib">

  <div class="section-header">
    <div class="section-dot ib-accent"></div>
    <div class="section-title ib-accent">Inside Bar Failure System ‚Äî BTC</div>
  </div>

  <!-- CALCULATOR -->
  <div class="calc-card">
    <div class="calc-card-title">‚ö° Position Size Calculator</div>
    <div class="calc-grid">
      <div class="calc-field">
        <div class="calc-label">Account Size ($)</div>
        <input class="calc-input" id="ib-account" type="number" placeholder="114000" value="110000" oninput="calcIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Risk %</div>
        <input class="calc-input" id="ib-risk" type="number" placeholder="2" value="2" step="0.5" oninput="calcIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Entry Price ($)</div>
        <input class="calc-input" id="ib-entry" type="number" placeholder="0.00" oninput="calcIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Stop Price ($)</div>
        <input class="calc-input" id="ib-stop" type="number" placeholder="0.00" oninput="calcIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Target Price ($)</div>
        <input class="calc-input" id="ib-target" type="number" placeholder="0.00" oninput="calcIB()">
      </div>
    </div>
    <div class="calc-result">
      <div class="result-item">
        <div class="result-label">Dollar Risk</div>
        <div class="result-value cyan" id="ib-dollar-risk">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">Shares</div>
        <div class="result-value cyan" id="ib-shares">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">Stop Distance</div>
        <div class="result-value red" id="ib-stop-dist">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">R/R Ratio</div>
        <div class="result-value green" id="ib-rr">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- FORM -->
  <div class="form-card">
    <div class="form-section-header ib">Pre-Trade Plan</div>
    <div class="form-body three">
      <div class="form-field">
        <div class="form-label">Ticker</div>
        <input class="form-input" id="ib-ticker" type="text" placeholder="AAPL">
      </div>
      <div class="form-field">
        <div class="form-label">Date</div>
        <input class="form-input" id="ib-date" type="date">
      </div>
      <div class="form-field">
        <div class="form-label">Direction</div>
        <select class="form-select" id="ib-direction">
          <option value="">Select</option>
          <option value="Long">Long</option>
          <option value="Short">Short</option>
        </select>
      </div>
    </div>
  </div>

  <div class="form-card">
    <div class="form-section-header ib" style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;">
      <span id="ib-tf-label">Inside Bar Levels</span>
      <select class="form-select" id="ib-bias-tf" style="width:auto;min-width:160px;padding:5px 10px;font-size:0.72rem;" onchange="updateIBLabel()">
        <optgroup label="Monthly">
          <option value="Monthly">Monthly</option>
          <option value="2-Month">2-Month</option>
        </optgroup>
        <optgroup label="Weekly">
          <option value="Weekly">Weekly</option>
          <option value="2-Week">2-Week</option>
          <option value="3-Week">3-Week</option>
        </optgroup>
        <optgroup label="Daily">
          <option value="1-Day">1-Day</option>
          <option value="2-Day">2-Day</option>
          <option value="3-Day">3-Day</option>
          <option value="4-Day">4-Day</option>
          <option value="5-Day">5-Day</option>
        </optgroup>
      </select>
    </div>
    <div class="form-body two">
      <div class="form-field">
        <div class="form-label" id="ib-mb-high-label">Mother Bar High</div>
        <input class="form-input" id="ib-mb-high" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label" id="ib-mb-low-label">Mother Bar Low</div>
        <input class="form-input" id="ib-mb-low" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Inside Bar High</div>
        <input class="form-input" id="ib-ib-high" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Inside Bar Low</div>
        <input class="form-input" id="ib-ib-low" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Break Side</div>
        <select class="form-select" id="ib-break-side">
          <option value="">Select</option>
          <option value="High (bearish signal)">High (bearish signal)</option>
          <option value="Low (bullish signal)">Low (bullish signal)</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Expiration Date</div>
        <input class="form-input" id="ib-expiry" type="date">
      </div>
    </div>
  </div>

  <div class="form-card">
    <div class="form-section-header green">Entry Trigger (Hourly / Daily)</div>
    <div class="form-body two">
      <div class="form-field">
        <div class="form-label">Trigger Type</div>
        <select class="form-select" id="ib-trigger">
          <option value="">Select</option>
          <option value="Inside Bar Failure">Inside Bar Failure</option>
          <option value="SFP">SFP</option>
          <option value="Engulfing">Engulfing</option>
          <option value="SFP + Engulfing">SFP + Engulfing</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Entry Timeframe</div>
        <select class="form-select" id="ib-entry-tf">
          <option value="">Select</option>
          <option value="Hourly">Hourly</option>
          <option value="4H">4H</option>
          <option value="Daily">Daily</option>
        </select>
      </div>
    </div>
  </div>

  <div class="form-card">
    <div class="form-section-header red">Risk</div>
    <div class="form-body three">
      <div class="form-field">
        <div class="form-label">Entry Price</div>
        <input class="form-input" id="ib-f-entry" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Stop Price</div>
        <input class="form-input" id="ib-f-stop" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Target (other side MB)</div>
        <input class="form-input" id="ib-f-target" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Position Size (shares)</div>
        <input class="form-input" id="ib-f-size" type="number" placeholder="0">
      </div>
      <div class="form-field">
        <div class="form-label">Dollar Risk</div>
        <input class="form-input" id="ib-f-drisk" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">R/R</div>
        <input class="form-input" id="ib-f-rr" type="text" placeholder="e.g. 8:1">
      </div>
    </div>
  </div>

  <div class="form-card">
    <div class="form-section-header grey">Trade Reasoning</div>
    <div class="form-body full">
      <div class="form-field">
        <div class="form-label">Why am I taking this trade?</div>
        <textarea class="form-textarea" id="ib-reasoning" placeholder="Describe the setup, confluences, and why this meets all your rules..."></textarea>
      </div>
    </div>
  </div>

  <div class="form-card">
    <div class="form-section-header green">Post-Trade Review</div>
    <div class="form-body three">
      <div class="form-field">
        <div class="form-label">Exit Price</div>
        <input class="form-input" id="ib-exit" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">P&L ($)</div>
        <input class="form-input" id="ib-pnl" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Outcome</div>
        <select class="form-select" id="ib-outcome">
          <option value="Open">Open</option>
          <option value="Win">Win</option>
          <option value="Loss">Loss</option>
          <option value="Breakeven">Breakeven</option>
        </select>
      </div>
    </div>
    <div class="form-body two">
      <div class="form-field">
        <div class="form-label">Did I follow my plan?</div>
        <select class="form-select" id="ib-followed">
          <option value="">Select</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Partially">Partially</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Process Grade</div>
        <div class="radio-group">
          <div class="radio-option"><input type="radio" name="ib-grade" id="ib-ga" value="A"><label for="ib-ga">A</label></div>
          <div class="radio-option"><input type="radio" name="ib-grade" id="ib-gb" value="B"><label for="ib-gb">B</label></div>
          <div class="radio-option"><input type="radio" name="ib-grade" id="ib-gc" value="C"><label for="ib-gc">C</label></div>
          <div class="radio-option"><input type="radio" name="ib-grade" id="ib-gd" value="D"><label for="ib-gd">D</label></div>
        </div>
      </div>
    </div>
    <div class="form-body full">
      <div class="form-field">
        <div class="form-label">Lessons Learned</div>
        <textarea class="form-textarea" id="ib-lessons" placeholder="What did you do well? What will you improve?"></textarea>
      </div>
    </div>
  </div>

  <button class="save-btn ib" onclick="saveTrade('ib')">Save Trade to Log</button>
</div>

<!-- ==================== TAB: FIBONACCI ==================== -->
<div class="tab-content" id="tab-fib">

  <div class="section-header">
    <div class="section-dot fib-accent"></div>
    <div class="section-title fib-accent">Fibonacci Retracement System</div>
  </div>

  <!-- CALCULATOR -->
  <div class="calc-card">
    <div class="calc-card-title">‚ö° Position Size Calculator</div>
    <div class="calc-grid">
      <div class="calc-field">
        <div class="calc-label">Account Size ($)</div>
        <input class="calc-input fib-focus" id="fib-account" type="number" placeholder="114000" value="110000" oninput="calcFIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Risk %</div>
        <input class="calc-input fib-focus" id="fib-risk" type="number" placeholder="2" value="2" step="0.5" oninput="calcFIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Swing High ($)</div>
        <input class="calc-input fib-focus" id="fib-high" type="number" placeholder="0.00" oninput="calcFIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Swing Low ($)</div>
        <input class="calc-input fib-focus" id="fib-low" type="number" placeholder="0.00" oninput="calcFIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Entry Price ($)</div>
        <input class="calc-input fib-focus" id="fib-entry" type="number" placeholder="0.00" oninput="calcFIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Stop Price ($)</div>
        <input class="calc-input fib-focus" id="fib-stop" type="number" placeholder="0.00" oninput="calcFIB()">
      </div>
    </div>

    <!-- FIB LEVELS DISPLAY -->
    <div class="fib-levels-display">
      <div class="fib-levels-grid" style="grid-template-columns: repeat(3, 1fr);">
        <div class="fib-level-item entry-zone"><div class="fib-level-label">0.618 ‚Äî Entry Level ‚úì</div><div class="fib-level-value" id="fl-618">‚Äî</div></div>
        <div class="fib-level-item stop-zone"><div class="fib-level-label">0.786 ‚Äî Reference Only</div><div class="fib-level-value" id="fl-786">‚Äî</div></div>
        <div class="fib-level-item stop-zone"><div class="fib-level-label">Stop ‚Äî Below Swing Low ‚úó</div><div class="fib-level-value" id="fl-swing-stop">‚Äî</div></div>
      </div>
    </div>

    <div class="calc-result">
      <div class="result-item">
        <div class="result-label">Dollar Risk</div>
        <div class="result-value purple" id="fib-dollar-risk">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">Total Shares</div>
        <div class="result-value purple" id="fib-shares">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">R/R to 1.618 (BE level)</div>
        <div class="result-value gold" id="fib-rr1">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">R/R to 2.618 (Target)</div>
        <div class="result-value green" id="fib-rr2">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- FORM -->
  <div class="form-card fib-form">
    <div class="form-section-header fib">Pre-Trade Plan</div>
    <div class="form-body three">
      <div class="form-field">
        <div class="form-label">Ticker</div>
        <input class="form-input" id="fib-ticker" type="text" placeholder="AAPL">
      </div>
      <div class="form-field">
        <div class="form-label">Date</div>
        <input class="form-input" id="fib-date" type="date">
      </div>
      <div class="form-field">
        <div class="form-label">Direction</div>
        <select class="form-select" id="fib-direction">
          <option value="">Select</option>
          <option value="Long">Long</option>
          <option value="Short">Short</option>
        </select>
      </div>
    </div>
  </div>

  <div class="form-card fib-form">
    <div class="form-section-header fib">Swing Points</div>
    <div class="form-body two">
      <div class="form-field">
        <div class="form-label">Swing High Price</div>
        <input class="form-input" id="fib-f-high" type="number" placeholder="0.00" oninput="calcSwingSize()">
      </div>
      <div class="form-field">
        <div class="form-label">Swing Low Price</div>
        <input class="form-input" id="fib-f-low" type="number" placeholder="0.00" oninput="calcSwingSize()">
      </div>
      <div class="form-field">
        <div class="form-label">Bias Timeframe</div>
        <select class="form-select" id="fib-tf">
          <option value="">Select</option>
          <option value="Daily">Daily</option>
          <option value="Weekly">Weekly</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Swing Size % <span id="swing-size-badge" style="margin-left:8px;padding:2px 8px;border-radius:3px;font-size:0.8rem;font-weight:700;">‚Äî</span></div>
        <input class="form-input" id="fib-swing-size" type="text" placeholder="Auto-calculated" readonly style="background:#111;color:#667;cursor:default;">
      </div>
    </div>
    <div id="swing-size-warning" style="display:none;margin:8px 16px 4px;padding:8px 12px;background:rgba(255,68,102,0.08);border:1px solid rgba(255,68,102,0.3);border-radius:4px;color:#ff4466;font-size:0.82rem;">
      ‚ö† Swing size is under 50% ‚Äî backtest shows 0% win rate on swings this small. Do not take this trade.
    </div>
  </div>

  <div class="form-card fib-form">
    <div class="form-section-header green">Entry Trigger (Daily)</div>
    <div class="form-body two">
      <div class="form-field">
        <div class="form-label">Trigger Type</div>
        <select class="form-select" id="fib-trigger">
          <option value="">Select</option>
          <option value="Inside Bar Failure">Inside Bar Failure</option>
          <option value="SFP">SFP</option>
          <option value="Engulfing">Engulfing</option>
          <option value="SFP + Engulfing">SFP + Engulfing</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Is Price at 0.618 Level?</div>
        <select class="form-select" id="fib-in-zone">
          <option value="">Select</option>
          <option value="Yes ‚Äî at 0.618">Yes ‚Äî at 0.618 ‚úì</option>
          <option value="No ‚Äî DO NOT ENTER">No ‚Äî DO NOT ENTER</option>
        </select>
      </div>
    </div>
  </div>

  <div class="form-card fib-form">
    <div class="form-section-header red">Risk</div>
    <div class="form-body three">
      <div class="form-field">
        <div class="form-label">Entry Price (0.618)</div>
        <input class="form-input" id="fib-f-entry" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Stop Price (below swing low)</div>
        <input class="form-input" id="fib-f-stop" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Total Shares</div>
        <input class="form-input" id="fib-f-size" type="number" placeholder="0">
      </div>
      <div class="form-field">
        <div class="form-label">1.618 Level (move stop to BE here)</div>
        <input class="form-input" id="fib-f-t1" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Target Price (2.618)</div>
        <input class="form-input" id="fib-f-t2" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Dollar Risk</div>
        <input class="form-input" id="fib-f-drisk" type="number" placeholder="0.00">
      </div>
    </div>
  </div>

  <div class="form-card fib-form">
    <div class="form-section-header grey">Trade Reasoning</div>
    <div class="form-body full">
      <div class="form-field">
        <div class="form-label">Why am I taking this trade?</div>
        <textarea class="form-textarea" id="fib-reasoning" placeholder="Describe the swing (must be ‚â•50%), confirm 0.618 entry level, daily trigger type, and stop below swing low..."></textarea>
      </div>
    </div>
  </div>

  <div class="form-card fib-form">
    <div class="form-section-header gold">Post-Trade Review</div>
    <div class="form-body three">
      <div class="form-field">
        <div class="form-label">1.618 Level ‚Äî Stop moved to BE?</div>
        <select class="form-select" id="fib-be-moved">
          <option value="">Select</option>
          <option value="Yes">Yes ‚úì</option>
          <option value="No">No ‚úó</option>
          <option value="Not reached yet">Not reached yet</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Exit Price (2.618 Target)</div>
        <input class="form-input" id="fib-exit-t2" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Total P&L ($)</div>
        <input class="form-input" id="fib-pnl" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Outcome</div>
        <select class="form-select" id="fib-outcome">
          <option value="Open">Open</option>
          <option value="Win ‚Äî 2.618 Target Hit">Win ‚Äî 2.618 Target Hit</option>
          <option value="Stopped at Breakeven">Stopped at Breakeven</option>
          <option value="Loss">Loss</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Process Grade</div>
        <div class="radio-group fib-form">
          <div class="radio-option"><input type="radio" name="fib-grade" id="fib-ga" value="A"><label for="fib-ga">A</label></div>
          <div class="radio-option"><input type="radio" name="fib-grade" id="fib-gb" value="B"><label for="fib-gb">B</label></div>
          <div class="radio-option"><input type="radio" name="fib-grade" id="fib-gc" value="C"><label for="fib-gc">C</label></div>
          <div class="radio-option"><input type="radio" name="fib-grade" id="fib-gd" value="D"><label for="fib-gd">D</label></div>
        </div>
      </div>
    </div>
    <div class="form-body full">
      <div class="form-field">
        <div class="form-label">Lessons Learned</div>
        <textarea class="form-textarea" id="fib-lessons" placeholder="What did you do well? What will you improve?"></textarea>
      </div>
    </div>
  </div>

  <button class="save-btn fib" onclick="saveTrade('fib')">Save Trade to Log</button>
</div>

<!-- ==================== TAB: WEEKLY STOCK IB ==================== -->
<div class="tab-content" id="tab-wib">

  <div class="section-header">
    <div class="section-dot" style="background:#00ffcc;box-shadow:0 0 8px rgba(0,255,204,0.5)"></div>
    <div class="section-title" style="color:#00ffcc">Weekly Stock IB ‚Äî Fade the Breakout</div>
  </div>

  <!-- CALCULATOR -->
  <div class="calc-card">
    <div class="calc-card-title">‚ö° Position Size Calculator</div>
    <div class="calc-grid">
      <div class="calc-field">
        <div class="calc-label">Account Size ($)</div>
        <input class="calc-input" id="wib-account" type="number" value="114000" oninput="calcWIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Risk %</div>
        <input class="calc-input" id="wib-risk" type="number" value="1" step="0.5" oninput="calcWIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Mother Bar High ($)</div>
        <input class="calc-input" id="wib-mb-high" type="number" placeholder="0.00" oninput="calcWIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Mother Bar Low ($)</div>
        <input class="calc-input" id="wib-mb-low" type="number" placeholder="0.00" oninput="calcWIB()">
      </div>
      <div class="calc-field">
        <div class="calc-label">Direction</div>
        <select class="calc-input" id="wib-calc-dir" onchange="calcWIB()" style="cursor:pointer">
          <option value="short">Short (broke high)</option>
          <option value="long">Long (broke low)</option>
        </select>
      </div>
    </div>
    <div class="calc-result">
      <div class="result-item">
        <div class="result-label">Dollar Risk</div>
        <div class="result-value" style="color:#00ffcc" id="wib-dollar-risk">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">Shares</div>
        <div class="result-value" style="color:#00ffcc" id="wib-shares">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">Entry (break level)</div>
        <div class="result-value green" id="wib-entry-calc">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">Stop Price</div>
        <div class="result-value red" id="wib-stop-calc">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">Target (other side MB)</div>
        <div class="result-value gold" id="wib-target-calc">‚Äî</div>
      </div>
      <div class="result-item">
        <div class="result-label">R/R Ratio</div>
        <div class="result-value green" id="wib-rr-calc">‚Äî</div>
      </div>
    </div>
    <div id="wib-rr-warning" style="display:none;margin-top:8px;padding:8px 12px;background:rgba(255,68,102,0.1);border:1px solid rgba(255,68,102,0.3);border-radius:4px;color:#ff4466;font-family:'Share Tech Mono',monospace;font-size:0.75rem;letter-spacing:1px">
      ‚ö† R/R BELOW 10:1 ‚Äî DO NOT ENTER THIS TRADE
    </div>
  </div>

  <!-- PRE-TRADE PLAN -->
  <div class="form-card" style="border-color:rgba(0,255,204,0.15)">
    <div class="form-section-header" style="color:#00ffcc;border-color:rgba(0,255,204,0.3)">Pre-Trade Plan</div>
    <div class="form-body three">
      <div class="form-field">
        <div class="form-label">Ticker</div>
        <input class="form-input" id="wib-ticker" type="text" placeholder="MSFT">
      </div>
      <div class="form-field">
        <div class="form-label">Date</div>
        <input class="form-input" id="wib-date" type="date">
      </div>
      <div class="form-field">
        <div class="form-label">Direction</div>
        <select class="form-select" id="wib-direction">
          <option value="">Select</option>
          <option value="Short">Short (broke high, fading)</option>
          <option value="Long">Long (broke low, fading)</option>
        </select>
      </div>
    </div>
  </div>

  <div class="form-card" style="border-color:rgba(0,255,204,0.15)">
    <div class="form-section-header" style="color:#00ffcc;border-color:rgba(0,255,204,0.3)">Weekly Mother Bar Levels</div>
    <div class="form-body two">
      <div class="form-field">
        <div class="form-label">Mother Bar High</div>
        <input class="form-input" id="wib-f-mb-high" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Mother Bar Low</div>
        <input class="form-input" id="wib-f-mb-low" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Inside Bar High</div>
        <input class="form-input" id="wib-ib-high" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Inside Bar Low</div>
        <input class="form-input" id="wib-ib-low" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Break Side</div>
        <select class="form-select" id="wib-break-side">
          <option value="">Select</option>
          <option value="High broken (short setup)">High broken ‚Üí Short setup</option>
          <option value="Low broken (long setup)">Low broken ‚Üí Long setup</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Setup Expiry (4 weeks max)</div>
        <input class="form-input" id="wib-expiry" type="date">
      </div>
    </div>
  </div>

  <div class="form-card" style="border-color:rgba(0,255,204,0.15)">
    <div class="form-section-header red">Risk</div>
    <div class="form-body three">
      <div class="form-field">
        <div class="form-label">Entry Price (break level)</div>
        <input class="form-input" id="wib-f-entry" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Stop Price (0.5% beyond)</div>
        <input class="form-input" id="wib-f-stop" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Target (other side MB)</div>
        <input class="form-input" id="wib-f-target" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Position Size (shares)</div>
        <input class="form-input" id="wib-f-size" type="number" placeholder="0">
      </div>
      <div class="form-field">
        <div class="form-label">Dollar Risk</div>
        <input class="form-input" id="wib-f-drisk" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">R/R (must be ‚â•10:1)</div>
        <input class="form-input" id="wib-f-rr" type="text" placeholder="e.g. 14:1">
      </div>
    </div>
  </div>

  <div class="form-card" style="border-color:rgba(0,255,204,0.15)">
    <div class="form-section-header grey">Trade Reasoning</div>
    <div class="form-body full">
      <div class="form-field">
        <div class="form-label">Why am I taking this trade?</div>
        <textarea class="form-textarea" id="wib-reasoning" placeholder="Describe the weekly inside bar, confirm R/R ‚â•10:1, note which side broke and why the breakout failed..."></textarea>
      </div>
    </div>
  </div>

  <!-- POST-TRADE REVIEW -->
  <div class="form-card" style="border-color:rgba(0,255,204,0.15)">
    <div class="form-section-header green">Post-Trade Review</div>
    <div class="form-body three">
      <div class="form-field">
        <div class="form-label">Exit Price</div>
        <input class="form-input" id="wib-exit" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">P&L ($)</div>
        <input class="form-input" id="wib-pnl" type="number" placeholder="0.00">
      </div>
      <div class="form-field">
        <div class="form-label">Outcome</div>
        <select class="form-select" id="wib-outcome">
          <option value="Open">Open</option>
          <option value="Win ‚Äî Target Hit">Win ‚Äî Target Hit</option>
          <option value="Loss">Loss</option>
          <option value="Breakeven">Breakeven</option>
          <option value="Expired">Expired (4 weeks)</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Did price quickly fail the breakout?</div>
        <select class="form-select" id="wib-quick-fail">
          <option value="">Select</option>
          <option value="Yes ‚Äî failed within 1-2 weeks">Yes ‚Äî failed within 1-2 weeks</option>
          <option value="Slow ‚Äî took 3-4 weeks">Slow ‚Äî took 3-4 weeks</option>
          <option value="No ‚Äî breakout held">No ‚Äî breakout held</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">Process Grade</div>
        <div class="radio-group" style="--radio-color:#00ffcc">
          <div class="radio-option"><input type="radio" name="wib-grade" id="wib-ga" value="A"><label for="wib-ga">A</label></div>
          <div class="radio-option"><input type="radio" name="wib-grade" id="wib-gb" value="B"><label for="wib-gb">B</label></div>
          <div class="radio-option"><input type="radio" name="wib-grade" id="wib-gc" value="C"><label for="wib-gc">C</label></div>
          <div class="radio-option"><input type="radio" name="wib-grade" id="wib-gd" value="D"><label for="wib-gd">D</label></div>
        </div>
      </div>
    </div>
    <div class="form-body full">
      <div class="form-field">
        <div class="form-label">Lessons Learned</div>
        <textarea class="form-textarea" id="wib-lessons" placeholder="What did you do well? What will you improve?"></textarea>
      </div>
    </div>
  </div>

  <button class="save-btn" style="background:linear-gradient(135deg,#00aa88,#00ffcc);color:#001a14" onclick="saveTrade('wib')">Save Trade to Log</button>
</div>

<!-- ==================== TAB: TRADE LOG ==================== -->
<div class="tab-content" id="tab-log">
  <div class="section-header">
    <div class="section-dot log-accent"></div>
    <div class="section-title log-accent">Trade Log</div>
  </div>

  <div class="trade-filters">
    <button class="filter-btn active f-all" onclick="filterTrades('all', this)">All</button>
    <button class="filter-btn f-ib" onclick="filterTrades('ib', this)">Inside Bar</button>
    <button class="filter-btn f-fib" onclick="filterTrades('fib', this)">Fibonacci</button>
    <button class="filter-btn" onclick="filterTrades('wib', this)">Weekly Stock IB</button>
    <button class="filter-btn f-open" onclick="filterTrades('open', this)">Open</button>
    <button class="filter-btn f-win" onclick="filterTrades('win', this)">Wins</button>
    <button class="filter-btn f-loss" onclick="filterTrades('loss', this)">Losses</button>
  </div>

  <div class="trades-list" id="trades-list">
    <div class="empty-state">
      <div class="empty-state-icon">üì≠</div>
      <div class="empty-state-text">No trades logged yet</div>
    </div>
  </div>
</div>

<!-- ==================== TAB: STATS ==================== -->
<div class="tab-content" id="tab-stats">
  <div class="section-header">
    <div class="section-dot stats-accent"></div>
    <div class="section-title stats-accent">Performance Stats</div>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-card-label">Total Trades</div>
      <div class="stat-card-value neutral" id="stat-total">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Win Rate</div>
      <div class="stat-card-value" id="stat-wr">‚Äî</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Total P&L</div>
      <div class="stat-card-value" id="stat-pnl">$0</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Avg Win</div>
      <div class="stat-card-value green" id="stat-avg-win">‚Äî</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Avg Loss</div>
      <div class="stat-card-value red" id="stat-avg-loss">‚Äî</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Best Trade</div>
      <div class="stat-card-value green" id="stat-best">‚Äî</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">IB Trades</div>
      <div class="stat-card-value cyan" id="stat-ib">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Fib Trades</div>
      <div class="stat-card-value purple" id="stat-fib">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Weekly IB Trades</div>
      <div class="stat-card-value" style="color:#00ffcc" id="stat-wib">0</div>
    </div>
  </div>

  <div class="grade-breakdown">
    <div class="grade-title">Process Grade Distribution</div>
    <div class="grade-bars">
      <div class="grade-bar-row">
        <div class="grade-bar-label" style="color:var(--green)">A</div>
        <div class="grade-bar-track"><div class="grade-bar-fill" id="grade-a-bar" style="width:0%;background:var(--green)"></div></div>
        <div class="grade-bar-count" id="grade-a-count">0</div>
      </div>
      <div class="grade-bar-row">
        <div class="grade-bar-label" style="color:var(--cyan)">B</div>
        <div class="grade-bar-track"><div class="grade-bar-fill" id="grade-b-bar" style="width:0%;background:var(--cyan)"></div></div>
        <div class="grade-bar-count" id="grade-b-count">0</div>
      </div>
      <div class="grade-bar-row">
        <div class="grade-bar-label" style="color:var(--gold)">C</div>
        <div class="grade-bar-track"><div class="grade-bar-fill" id="grade-c-bar" style="width:0%;background:var(--gold)"></div></div>
        <div class="grade-bar-count" id="grade-c-count">0</div>
      </div>
      <div class="grade-bar-row">
        <div class="grade-bar-label" style="color:var(--red)">D</div>
        <div class="grade-bar-track"><div class="grade-bar-fill" id="grade-d-bar" style="width:0%;background:var(--red)"></div></div>
        <div class="grade-bar-count" id="grade-d-count">0</div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ---- IB TIMEFRAME LABEL ----
function updateIBLabel() {
  const tf = document.getElementById('ib-bias-tf').value;
  document.getElementById('ib-tf-label').textContent = tf + ' Inside Bar Levels';
  document.getElementById('ib-mb-high-label').textContent = tf + ' Mother Bar High';
  document.getElementById('ib-mb-low-label').textContent = tf + ' Mother Bar Low';
}

// ---- STORAGE ----
function getTrades() {
  try { return JSON.parse(localStorage.getItem('tradelog_v1') || '[]'); } catch(e) { return []; }
}
function saveTrades(trades) {
  localStorage.setItem('tradelog_v1', JSON.stringify(trades));
}

// ---- TABS ----
let activeTab = 'ib';
const tabActiveClasses = { ib: 'active-ib', fib: 'active-fib', wib: 'active-wib', log: 'active-log', stats: 'active-stats' };

function showTab(tab) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(el => {
    Object.values(tabActiveClasses).forEach(cls => el.classList.remove(cls));
  });
  document.getElementById('tab-' + tab).classList.add('active');
  const btns = document.querySelectorAll('.tab-btn');
  const idx = ['ib','fib','wib','log','stats'].indexOf(tab);
  btns[idx].classList.add(tabActiveClasses[tab]);
  activeTab = tab;
  if (tab === 'log') renderTrades();
  if (tab === 'stats') renderStats();
}

// ---- CALCULATOR: IB ----
function calcIB() {
  const account = parseFloat(document.getElementById('ib-account').value) || 0;
  const risk = parseFloat(document.getElementById('ib-risk').value) || 0;
  const entry = parseFloat(document.getElementById('ib-entry').value) || 0;
  const stop = parseFloat(document.getElementById('ib-stop').value) || 0;
  const target = parseFloat(document.getElementById('ib-target').value) || 0;

  const dollarRisk = account * (risk / 100);
  const stopDist = Math.abs(entry - stop);
  const shares = stopDist > 0 ? Math.floor(dollarRisk / stopDist) : 0;
  const reward = Math.abs(target - entry);
  const rr = stopDist > 0 && reward > 0 ? (reward / stopDist).toFixed(1) : null;

  document.getElementById('ib-dollar-risk').textContent = dollarRisk > 0 ? '$' + dollarRisk.toFixed(0) : '‚Äî';
  document.getElementById('ib-shares').textContent = shares > 0 ? shares.toLocaleString() : '‚Äî';
  document.getElementById('ib-stop-dist').textContent = stopDist > 0 ? '$' + stopDist.toFixed(2) : '‚Äî';
  document.getElementById('ib-rr').textContent = rr ? rr + ':1' : '‚Äî';
}

// ---- CALCULATOR: FIB ----
function calcFIB() {
  const account = parseFloat(document.getElementById('fib-account').value) || 0;
  const risk    = parseFloat(document.getElementById('fib-risk').value)    || 0;
  const high    = parseFloat(document.getElementById('fib-high').value)    || 0;
  const low     = parseFloat(document.getElementById('fib-low').value)     || 0;
  const entry   = parseFloat(document.getElementById('fib-entry').value)   || 0;
  const stop    = parseFloat(document.getElementById('fib-stop').value)    || 0;

  const range = high - low;

  if (range > 0) {
    // Retracement levels (from high down toward low)
    document.getElementById('fl-618').textContent     = '$' + (high - range * 0.618).toFixed(2);
    document.getElementById('fl-786').textContent     = '$' + (high - range * 0.786).toFixed(2);
    // Swing low stop = 0.5% below the swing low
    document.getElementById('fl-swing-stop').textContent = '$' + (low * 0.995).toFixed(2);
  } else {
    ['fl-618','fl-786','fl-swing-stop'].forEach(id => {
      document.getElementById(id).textContent = '‚Äî';
    });
  }

  const dollarRisk = account * (risk / 100);
  const stopDist   = Math.abs(entry - stop);
  const shares     = stopDist > 0 ? Math.floor(dollarRisk / stopDist) : 0;

  // Extensions: T1 = 1.618 extension above swing high, T2 = 2.618 extension
  const t1Price  = range > 0 ? (high + range * 0.618) : 0;
  const t2Price  = range > 0 ? (high + range * 1.618) : 0;
  const rewardT1 = entry > 0 ? Math.abs(t1Price - entry) : 0;
  const rewardT2 = entry > 0 ? Math.abs(t2Price - entry) : 0;
  const rr1 = stopDist > 0 && rewardT1 > 0 ? (rewardT1 / stopDist).toFixed(1) : null;
  const rr2 = stopDist > 0 && rewardT2 > 0 ? (rewardT2 / stopDist).toFixed(1) : null;

  document.getElementById('fib-dollar-risk').textContent  = dollarRisk > 0 ? '$' + dollarRisk.toFixed(0) : '‚Äî';
  document.getElementById('fib-shares').textContent       = shares > 0 ? shares.toLocaleString() : '‚Äî';
  document.getElementById('fib-rr1').textContent          = rr1 ? rr1 + ':1' : '‚Äî';
  document.getElementById('fib-rr2').textContent          = rr2 ? rr2 + ':1' : '‚Äî';
}

// ---- SWING SIZE CHECK ----
function calcSwingSize() {
  const high = parseFloat(document.getElementById('fib-f-high').value) || 0;
  const low  = parseFloat(document.getElementById('fib-f-low').value)  || 0;
  const sizeEl   = document.getElementById('fib-swing-size');
  const badge    = document.getElementById('swing-size-badge');
  const warning  = document.getElementById('swing-size-warning');

  if (high > 0 && low > 0 && high > low) {
    const pct = ((high - low) / low * 100).toFixed(1);
    sizeEl.value = pct + '%';
    if (parseFloat(pct) >= 50) {
      badge.textContent = pct + '% ‚úì';
      badge.style.background = 'rgba(0,255,136,0.15)';
      badge.style.color = '#00ff88';
      badge.style.border = '1px solid rgba(0,255,136,0.3)';
      warning.style.display = 'none';
    } else {
      badge.textContent = pct + '% ‚úó';
      badge.style.background = 'rgba(255,68,102,0.15)';
      badge.style.color = '#ff4466';
      badge.style.border = '1px solid rgba(255,68,102,0.3)';
      warning.style.display = 'block';
    }
  } else {
    sizeEl.value = '';
    badge.textContent = '‚Äî';
    badge.style.background = 'transparent';
    badge.style.color = '#667';
    badge.style.border = 'none';
    warning.style.display = 'none';
  }
}

// ---- CALCULATOR: WIB ----
function calcWIB() {
  const account = parseFloat(document.getElementById('wib-account').value) || 0;
  const risk    = parseFloat(document.getElementById('wib-risk').value) || 0;
  const mbHigh  = parseFloat(document.getElementById('wib-mb-high').value) || 0;
  const mbLow   = parseFloat(document.getElementById('wib-mb-low').value) || 0;
  const dir     = document.getElementById('wib-calc-dir').value;

  const dollarRisk = account * (risk / 100);
  const range = mbHigh - mbLow;

  let entry, stop, target, stopDist, rr;
  if (dir === 'short' && mbHigh > 0) {
    entry    = mbHigh;
    stop     = mbHigh * 1.005;
    target   = mbLow;
    stopDist = stop - entry;
    rr       = stopDist > 0 ? (range / stopDist) : 0;
  } else if (dir === 'long' && mbLow > 0) {
    entry    = mbLow;
    stop     = mbLow * 0.995;
    target   = mbHigh;
    stopDist = entry - stop;
    rr       = stopDist > 0 ? (range / stopDist) : 0;
  } else {
    stopDist = 0; rr = 0;
  }

  const shares = stopDist > 0 ? Math.floor(dollarRisk / stopDist) : 0;

  document.getElementById('wib-dollar-risk').textContent  = dollarRisk > 0 ? '$' + dollarRisk.toFixed(0) : '‚Äî';
  document.getElementById('wib-shares').textContent       = shares > 0 ? shares.toLocaleString() : '‚Äî';
  document.getElementById('wib-entry-calc').textContent   = entry  > 0 ? '$' + entry.toFixed(2) : '‚Äî';
  document.getElementById('wib-stop-calc').textContent    = stop   > 0 ? '$' + stop.toFixed(2)  : '‚Äî';
  document.getElementById('wib-target-calc').textContent  = target > 0 ? '$' + target.toFixed(2) : '‚Äî';
  document.getElementById('wib-rr-calc').textContent      = rr > 0 ? rr.toFixed(1) + ':1' : '‚Äî';

  const warn = document.getElementById('wib-rr-warning');
  if (rr > 0 && rr < 10) { warn.style.display = 'block'; }
  else { warn.style.display = 'none'; }
}

// ---- SAVE TRADE ----
function saveTrade(system) {
  let trade = { id: Date.now(), system, createdAt: new Date().toISOString() };

  if (system === 'ib') {
    const ticker = document.getElementById('ib-ticker').value.trim().toUpperCase();
    if (!ticker) { showToast('Enter a ticker symbol', 'error'); return; }
    const grade = document.querySelector('input[name="ib-grade"]:checked');
    trade = { ...trade,
      ticker,
      date: document.getElementById('ib-date').value,
      direction: document.getElementById('ib-direction').value,
      biasTf: document.getElementById('ib-bias-tf').value,
      mbHigh: document.getElementById('ib-mb-high').value,
      mbLow: document.getElementById('ib-mb-low').value,
      ibHigh: document.getElementById('ib-ib-high').value,
      ibLow: document.getElementById('ib-ib-low').value,
      breakSide: document.getElementById('ib-break-side').value,
      expiry: document.getElementById('ib-expiry').value,
      trigger: document.getElementById('ib-trigger').value,
      entryTf: document.getElementById('ib-entry-tf').value,
      entry: document.getElementById('ib-f-entry').value,
      stop: document.getElementById('ib-f-stop').value,
      target: document.getElementById('ib-f-target').value,
      size: document.getElementById('ib-f-size').value,
      dollarRisk: document.getElementById('ib-f-drisk').value,
      rr: document.getElementById('ib-f-rr').value,
      reasoning: document.getElementById('ib-reasoning').value,
      exit: document.getElementById('ib-exit').value,
      pnl: parseFloat(document.getElementById('ib-pnl').value) || 0,
      outcome: document.getElementById('ib-outcome').value,
      followed: document.getElementById('ib-followed').value,
      grade: grade ? grade.value : '',
      lessons: document.getElementById('ib-lessons').value,
    };
  } else {
    const ticker = document.getElementById('fib-ticker').value.trim().toUpperCase();
    if (!ticker) { showToast('Enter a ticker symbol', 'error'); return; }
    const grade = document.querySelector('input[name="fib-grade"]:checked');
    trade = { ...trade,
      ticker,
      date: document.getElementById('fib-date').value,
      direction: document.getElementById('fib-direction').value,
      swingHigh: document.getElementById('fib-f-high').value,
      swingLow: document.getElementById('fib-f-low').value,
      swingSize: document.getElementById('fib-swing-size').value,
      biasTf: document.getElementById('fib-tf').value,
      trigger: document.getElementById('fib-trigger').value,
      atLevel: document.getElementById('fib-in-zone').value,
      entry: document.getElementById('fib-f-entry').value,
      stop: document.getElementById('fib-f-stop').value,
      size: document.getElementById('fib-f-size').value,
      t1Price: document.getElementById('fib-f-t1').value,
      t2Price: document.getElementById('fib-f-t2').value,
      dollarRisk: document.getElementById('fib-f-drisk').value,
      reasoning: document.getElementById('fib-reasoning').value,
      exitT2: document.getElementById('fib-exit-t2').value,
      pnl: parseFloat(document.getElementById('fib-pnl').value) || 0,
      outcome: document.getElementById('fib-outcome').value,
      beMoved: document.getElementById('fib-be-moved').value,
      grade: grade ? grade.value : '',
      lessons: document.getElementById('fib-lessons').value,
    };
  } else if (system === 'wib') {
    const ticker = document.getElementById('wib-ticker').value.trim().toUpperCase();
    if (!ticker) { showToast('Enter a ticker symbol', 'error'); return; }
    const grade = document.querySelector('input[name="wib-grade"]:checked');
    trade = { ...trade,
      ticker,
      date: document.getElementById('wib-date').value,
      direction: document.getElementById('wib-direction').value,
      biasTf: 'Weekly',
      mbHigh: document.getElementById('wib-f-mb-high').value,
      mbLow: document.getElementById('wib-f-mb-low').value,
      ibHigh: document.getElementById('wib-ib-high').value,
      ibLow: document.getElementById('wib-ib-low').value,
      breakSide: document.getElementById('wib-break-side').value,
      expiry: document.getElementById('wib-expiry').value,
      entry: document.getElementById('wib-f-entry').value,
      stop: document.getElementById('wib-f-stop').value,
      target: document.getElementById('wib-f-target').value,
      size: document.getElementById('wib-f-size').value,
      dollarRisk: document.getElementById('wib-f-drisk').value,
      rr: document.getElementById('wib-f-rr').value,
      reasoning: document.getElementById('wib-reasoning').value,
      exit: document.getElementById('wib-exit').value,
      pnl: parseFloat(document.getElementById('wib-pnl').value) || 0,
      outcome: document.getElementById('wib-outcome').value,
      quickFail: document.getElementById('wib-quick-fail').value,
      grade: grade ? grade.value : '',
      lessons: document.getElementById('wib-lessons').value,
    };
  }

  const trades = getTrades();
  trades.unshift(trade);
  saveTrades(trades);
  updateHeaderStats();
  showToast('Trade saved ‚úì', 'success');
  clearForm(system);
}

function clearForm(system) {
  const inputs = document.querySelectorAll(`#tab-${system} .form-input, #tab-${system} .form-select, #tab-${system} .form-textarea`);
  inputs.forEach(el => { el.value = ''; });
  document.querySelectorAll(`input[name="${system}-grade"]`).forEach(r => r.checked = false);
}

// ---- RENDER TRADES ----
let currentFilter = 'all';

function filterTrades(filter, btn) {
  currentFilter = filter;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderTrades();
}

function renderTrades() {
  const trades = getTrades();
  const list = document.getElementById('trades-list');

  let filtered = trades;
  if (currentFilter === 'ib') filtered = trades.filter(t => t.system === 'ib');
  else if (currentFilter === 'fib') filtered = trades.filter(t => t.system === 'fib');
  else if (currentFilter === 'wib') filtered = trades.filter(t => t.system === 'wib');
  else if (currentFilter === 'open') filtered = trades.filter(t => t.outcome === 'Open');
  else if (currentFilter === 'win') filtered = trades.filter(t => t.outcome && t.outcome.toLowerCase().includes('win'));
  else if (currentFilter === 'loss') filtered = trades.filter(t => t.outcome === 'Loss');

  if (filtered.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üì≠</div><div class="empty-state-text">No trades found</div></div>`;
    return;
  }

  list.innerHTML = filtered.map(trade => {
    const isWin = trade.outcome && trade.outcome.toLowerCase().includes('win');
    const isLoss = trade.outcome === 'Loss';
    const isOpen = trade.outcome === 'Open';
    const pnlClass = isWin ? 'win' : isLoss ? 'loss' : 'open';
    const pnlStr = trade.pnl ? (trade.pnl > 0 ? '+$' : '-$') + Math.abs(trade.pnl).toFixed(2) : '‚Äî';
    const dateStr = trade.date || trade.createdAt?.slice(0,10) || '';

    return `<div class="trade-card ${trade.system}-card" onclick="toggleDetail(${trade.id})">
      <div class="trade-card-header">
        <div class="trade-card-left">
          <span class="trade-system-badge badge-${trade.system}">${trade.system === 'ib' ? 'IB' : trade.system === 'fib' ? 'FIB' : 'W-IB'}</span>
          <span class="trade-ticker">${trade.ticker}</span>
          <span class="trade-date">${dateStr}</span>
        </div>
        <div class="trade-card-right">
          <div class="trade-pnl ${pnlClass}">${pnlStr}</div>
          <div class="trade-rr">${trade.direction || ''} ${trade.outcome || 'Open'} ${trade.grade ? '¬∑ Grade ' + trade.grade : ''}</div>
        </div>
      </div>
      <div class="trade-card-detail" id="detail-${trade.id}">
        <div class="detail-grid">
          <div class="detail-item"><div class="detail-item-label">Timeframe</div><div class="detail-item-value">${trade.biasTf || '‚Äî'}</div></div>
          <div class="detail-item"><div class="detail-item-label">Entry</div><div class="detail-item-value">${trade.entry ? '$'+trade.entry : '‚Äî'}</div></div>
          <div class="detail-item"><div class="detail-item-label">Stop</div><div class="detail-item-value">${trade.stop ? '$'+trade.stop : '‚Äî'}</div></div>
          <div class="detail-item"><div class="detail-item-label">Size</div><div class="detail-item-value">${trade.size ? trade.size+' sh' : '‚Äî'}</div></div>
          <div class="detail-item"><div class="detail-item-label">Trigger</div><div class="detail-item-value">${trade.trigger || '‚Äî'}</div></div>
          ${trade.system === 'fib' ? `<div class="detail-item"><div class="detail-item-label">BE Level (1.618)</div><div class="detail-item-value">${trade.t1Price ? '$'+trade.t1Price : '‚Äî'}</div></div><div class="detail-item"><div class="detail-item-label">Target (2.618)</div><div class="detail-item-value">${trade.t2Price ? '$'+trade.t2Price : '‚Äî'}</div></div>` : `<div class="detail-item"><div class="detail-item-label">Target</div><div class="detail-item-value">${trade.target ? '$'+trade.target : '‚Äî'}</div></div>`}
          <div class="detail-item"><div class="detail-item-label">Dollar Risk</div><div class="detail-item-value">${trade.dollarRisk ? '$'+trade.dollarRisk : '‚Äî'}</div></div>
        </div>
        ${trade.reasoning ? `<div class="trade-notes-display"><strong style="color:var(--text3);font-size:0.65rem;letter-spacing:2px;text-transform:uppercase">REASONING:</strong><br>${trade.reasoning}</div>` : ''}
        ${trade.lessons ? `<div class="trade-notes-display" style="margin-top:6px"><strong style="color:var(--text3);font-size:0.65rem;letter-spacing:2px;text-transform:uppercase">LESSONS:</strong><br>${trade.lessons}</div>` : ''}
        <button class="delete-btn" onclick="deleteTrade(${trade.id}, event)">Delete Trade</button>
      </div>
    </div>`;
  }).join('');
}

function toggleDetail(id) {
  const el = document.getElementById('detail-' + id);
  if (el) el.classList.toggle('open');
}

function deleteTrade(id, e) {
  e.stopPropagation();
  if (!confirm('Delete this trade?')) return;
  const trades = getTrades().filter(t => t.id !== id);
  saveTrades(trades);
  renderTrades();
  updateHeaderStats();
}

// ---- STATS ----
function renderStats() {
  const trades = getTrades().filter(t => t.outcome !== 'Open');
  const allTrades = getTrades();

  const wins = trades.filter(t => t.outcome && t.outcome.toLowerCase().includes('win'));
  const losses = trades.filter(t => t.outcome === 'Loss');
  const totalPnl = allTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
  const winRate = trades.length > 0 ? ((wins.length / trades.length) * 100).toFixed(0) + '%' : '‚Äî';
  const avgWin = wins.length > 0 ? wins.reduce((s,t) => s + (t.pnl||0), 0) / wins.length : 0;
  const avgLoss = losses.length > 0 ? losses.reduce((s,t) => s + (t.pnl||0), 0) / losses.length : 0;
  const bestPnl = allTrades.length > 0 ? Math.max(...allTrades.map(t => t.pnl || 0)) : 0;

  document.getElementById('stat-total').textContent = allTrades.length;
  const wrEl = document.getElementById('stat-wr');
  wrEl.textContent = winRate;
  wrEl.className = 'stat-card-value ' + (wins.length > losses.length ? 'green' : losses.length > wins.length ? 'red' : 'neutral');

  const pnlEl = document.getElementById('stat-pnl');
  pnlEl.textContent = (totalPnl >= 0 ? '+$' : '-$') + Math.abs(totalPnl).toFixed(0);
  pnlEl.className = 'stat-card-value ' + (totalPnl > 0 ? 'green' : totalPnl < 0 ? 'red' : 'neutral');

  document.getElementById('stat-avg-win').textContent = avgWin > 0 ? '+$' + avgWin.toFixed(0) : '‚Äî';
  document.getElementById('stat-avg-loss').textContent = avgLoss < 0 ? '-$' + Math.abs(avgLoss).toFixed(0) : '‚Äî';
  document.getElementById('stat-best').textContent = bestPnl > 0 ? '+$' + bestPnl.toFixed(0) : '‚Äî';
  document.getElementById('stat-ib').textContent = allTrades.filter(t => t.system === 'ib').length;
  document.getElementById('stat-fib').textContent = allTrades.filter(t => t.system === 'fib').length;
  document.getElementById('stat-wib').textContent = allTrades.filter(t => t.system === 'wib').length;

  // grades
  const graded = allTrades.filter(t => t.grade);
  const total = graded.length || 1;
  ['A','B','C','D'].forEach(g => {
    const count = graded.filter(t => t.grade === g).length;
    document.getElementById('grade-' + g.toLowerCase() + '-bar').style.width = (count / total * 100) + '%';
    document.getElementById('grade-' + g.toLowerCase() + '-count').textContent = count;
  });
}

function updateHeaderStats() {
  const trades = getTrades();
  const totalPnl = trades.reduce((sum, t) => sum + (t.pnl || 0), 0);
  const closed = trades.filter(t => t.outcome !== 'Open');
  const wins = closed.filter(t => t.outcome && t.outcome.toLowerCase().includes('win'));
  const wr = closed.length > 0 ? ((wins.length / closed.length) * 100).toFixed(0) + '%' : '‚Äî';

  const pnlEl = document.getElementById('header-pnl');
  pnlEl.textContent = (totalPnl >= 0 ? '+$' : '-$') + Math.abs(totalPnl).toFixed(2);
  pnlEl.className = 'hstat-value ' + (totalPnl > 0 ? 'positive' : totalPnl < 0 ? 'negative' : 'neutral');
  document.getElementById('header-wr').textContent = wr;
}

// ---- TOAST ----
function showToast(msg, type = 'success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast ' + type;
  setTimeout(() => t.classList.add('show'), 10);
  setTimeout(() => t.classList.remove('show'), 2500);
}

// ---- INIT ----
document.addEventListener('DOMContentLoaded', () => {
  // Set today's date
  const today = new Date().toISOString().slice(0, 10);
  document.getElementById('ib-date').value = today;
  document.getElementById('fib-date').value = today;
  document.getElementById('wib-date').value = today;
  updateHeaderStats();
  calcIB();
  calcFIB();
  calcWIB();
});
</script>
</body>
</html>
